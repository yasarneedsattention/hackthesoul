<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GLYPH-GRIND // STABLE_RETAIL</title>
    <style>
        :root {
            --bg: #EFEFEF; --gba: #1A1A1A; --orange: #FF4500; --yellow: #FFD700;
            --font: "Helvetica", sans-serif;
        }

        body, html { 
            margin: 0; padding: 0; background: var(--bg); 
            font-family: var(--font); display: flex; justify-content: center; 
            align-items: center; height: 100vh; overflow: hidden; 
        }

        /* GBA FRAME */
        #wrapper {
            width: 90vw; max-width: 800px; aspect-ratio: 16/9;
            background: var(--gba); border-radius: 40px; padding: 20px;
            display: grid; grid-template-columns: 1fr 3fr 1fr; align-items: center;
            box-shadow: 0 10px 0 #000; border: 4px solid #333;
        }

        /* SCREEN */
        #screen { background: #000; padding: 5px; border-radius: 10px; height: 90%; position: relative; }
        #stage { 
            width: 100%; height: 100%; background: #FFF; position: relative; 
            overflow: hidden; border: 2px solid #000;
        }

        /* CHARACTERS */
        .entity { 
            position: absolute; bottom: 20px; width: 50px; height: 80px; 
            display: flex; flex-direction: column; align-items: center;
            transition: transform 0.05s; pointer-events: none;
        }
        .head { 
            width: 40px; height: 40px; background: #000; border-radius: 45%; 
            display: flex; justify-content: center; align-items: center;
            position: relative; border: 2px solid #000;
        }
        .head::after { 
            content: attr(data-label); position: absolute; top: -15px; 
            font-size: 8px; font-weight: 900; color: #000;
        }
        .torso { 
            width: 45px; height: 40px; background: #000; margin-top: 2px;
            display: flex; justify-content: center; align-items: center;
            font-size: 8px; font-weight: 900; color: #FFF; border: 2px solid #000;
        }

        /* UI/HUD */
        #hud { 
            position: absolute; top: 10px; width: 100%; 
            display: flex; justify-content: space-around; z-index: 10;
        }
        .hp-bar { width: 80px; height: 10px; border: 2px solid #000; background: #EEE; }
        .hp-fill { height: 100%; background: #000; width: 100%; transition: width 0.2s; }

        /* CONTROLS */
        .dpad { display: grid; grid-template-columns: repeat(3, 40px); grid-template-rows: repeat(3, 40px); }
        .btn { background: #222; border: 1px solid #444; color: #FFF; display: flex; justify-content: center; align-items: center; cursor: pointer; border-radius: 5px; }
        .action-group { display: flex; flex-direction: column; gap: 10px; align-items: center; }
        .a-b { width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: 900; color: #FFF; cursor: pointer; box-shadow: 0 4px 0 #000; }

        /* VFX */
        .flash { animation: flash-anim 0.1s; }
        @keyframes flash-anim { from { filter: invert(1); } to { filter: invert(0); } }
    </style>
</head>
<body>

<div id="wrapper">
    <div class="dpad">
        <div></div><div class="btn" id="up">▲</div><div></div>
        <div class="btn" id="left">◀</div><div></div><div class="btn" id="right">▶</div>
    </div>

    <div id="screen">
        <div id="stage">
            <div id="hud">
                <div class="hp-bar"><div id="hp1" class="hp-fill"></div></div>
                <div class="hp-bar"><div id="hp2" class="hp-fill" style="background:var(--yellow)"></div></div>
            </div>
            
            <div id="p1" class="entity">
                <div class="head" data-label='"YOU"'>● ●</div>
                <div class="torso">"ITEM"</div>
            </div>

            <div id="p2" class="entity" style="left: 250px;">
                <div class="head" data-label='"CPU"' style="background:var(--yellow)">✕ ✕</div>
                <div class="torso" style="background:var(--yellow); color:#000;">"VOID"</div>
            </div>
        </div>
    </div>

    <div class="action-group">
        <div class="a-b" id="btnA" style="background:var(--orange)">A</div>
        <div class="a-b" id="btnB" style="background:#444">B</div>
    </div>
</div>

<script>
    const state = {
        p1: { x: 50, y: 0, vy: 0, hp: 100, dir: 1, atk: false },
        p2: { x: 250, y: 0, vy: 0, hp: 100, dir: -1, atk: false },
        inputs: {},
        active: true
    };

    const bind = (id, key) => {
        const el = document.getElementById(id);
        el.onmousedown = el.ontouchstart = (e) => { e.preventDefault(); state.inputs[key] = true; };
        el.onmouseup = el.ontouchend = () => state.inputs[key] = false;
    };

    bind('left', 'left'); bind('right', 'right'); bind('up', 'up');
    bind('btnA', 'a'); bind('btnB', 'b');

    // Keyboard support
    window.onkeydown = (e) => state.inputs[e.key.toLowerCase()] = true;
    window.onkeyup = (e) => state.inputs[e.key.toLowerCase()] = false;

    function doAttack(attacker, victim, dmg) {
        if (attacker.atk) return;
        attacker.atk = true;
        
        const dist = Math.abs(attacker.x - victim.x);
        if (dist < 60) {
            victim.hp -= dmg;
            document.getElementById('stage').classList.add('flash');
            setTimeout(() => document.getElementById('stage').classList.remove('flash'), 100);
            updateHUD();
        }

        setTimeout(() => attacker.atk = false, 300);
    }

    function updateHUD() {
        document.getElementById('hp1').style.width = Math.max(0, state.p1.hp) + '%';
        document.getElementById('hp2').style.width = Math.max(0, state.p2.hp) + '%';
        if (state.p2.hp <= 0) { alert("MATCH_WON"); location.reload(); }
    }

    function loop() {
        if (state.active) {
            // P1 Logic
            if (state.inputs['left'] || state.inputs['a']) { state.p1.x -= 4; state.p1.dir = -1; }
            if (state.inputs['right'] || state.inputs['d']) { state.p1.x += 4; state.p1.dir = 1; }
            if ((state.inputs['up'] || state.inputs['w']) && state.p1.y === 0) { state.p1.vy = -12; }
            if (state.inputs['k'] || state.inputs['a']) doAttack(state.p1, state.p2, 10);
            if (state.inputs['j'] || state.inputs['b']) doAttack(state.p1, state.p2, 5);

            // CPU Logic
            if (state.p2.x > state.p1.x + 60) state.p2.x -= 2;
            else if (state.p2.x < state.p1.x - 60) state.p2.x += 2;
            else if (Math.random() > 0.98) doAttack(state.p2, state.p1, 5);

            // Simple Physics
            [state.p1, state.p2].forEach(p => {
                p.y -= p.vy; p.vy += 0.8;
                if (p.y <= 0) { p.y = 0; p.vy = 0; }
                p.x = Math.max(0, Math.min(300, p.x));
                const el = document.getElementById(p === state.p1 ? 'p1' : 'p2');
                el.style.transform = `translate(${p.x}px, ${-p.y}px) scaleX(${p.dir})`;
            });
        }
        requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>
