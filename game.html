<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GLYPH-GRIND // PRO_RETAIL</title>
    <style>
        :root {
            --bg: #D4D4D4; --gba: #2D2D2D; --safety: #FF4500; --yellow: #FFD700;
            --pink: #FF69B4; --cyan: #00FFFF; --font: "Helvetica", sans-serif;
        }

        body, html { margin: 0; padding: 0; background: var(--bg); font-family: var(--font); display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; text-transform: uppercase; }

        /* GBA HARDWARE */
        #console { width: 95vw; max-width: 900px; aspect-ratio: 16/10; background: var(--gba); border-radius: 35px; padding: 15px; display: grid; grid-template-columns: 1.2fr 4fr 1.2fr; align-items: center; box-shadow: 0 12px 0 #000; border: 4px solid #444; }

        /* SCREEN */
        #screen { background: #000; padding: 6px; border-radius: 8px; height: 92%; position: relative; overflow: hidden; }
        #viewport { width: 100%; height: 100%; background: #FFF; position: relative; overflow: hidden; }

        /* DESIGNER DOCK (TOP) */
        #dock {
            position: absolute; top: 0; left: 0; width: 100%; height: 50px;
            background: rgba(255,255,255,0.9); border-bottom: 2px solid #000;
            display: flex; overflow-x: auto; align-items: center; gap: 8px; padding: 0 10px; z-index: 100;
            scrollbar-width: none;
        }
        .dock-item { flex: 0 0 auto; padding: 4px 8px; border: 1px solid #000; font-size: 8px; font-weight: 900; cursor: pointer; background: #EEE; }
        .dock-item:active { background: var(--safety); color: #FFF; }

        /* CHARACTERS */
        .player { position: absolute; width: 40px; height: 65px; display: flex; flex-direction: column; align-items: center; z-index: 10; pointer-events: none; }
        .head { width: 32px; height: 32px; border-radius: 45%; border: 2px solid #000; display: flex; justify-content: center; align-items: center; position: relative; background: #000; }
        .ears { position: absolute; top: -12px; width: 100%; display: none; justify-content: space-between; }
        .ear { width: 10px; height: 18px; background: inherit; clip-path: polygon(50% 0%, 0% 100%, 100% 100%); border: 1px solid #000; }
        .teeth { width: 20px; height: 8px; background: #FFF; clip-path: polygon(0 0, 20% 100%, 40% 0, 60% 100%, 80% 0, 100% 100%, 100% 0); display: none; margin-top: 10px; }
        .torso { width: 38px; height: 32px; border: 2px solid #000; margin-top: 2px; display: flex; justify-content: center; align-items: center; font-size: 6px; font-weight: 900; position: relative; }
        
        /* GENDER-NEUTRAL SILHOUETTES */
        .wide { width: 45px !important; } /* Masculine/Broad feel */
        .taper { border-radius: 0 0 15px 15px; } /* Feminine/Fluid feel */
        
        /* HUD */
        #hud { position: absolute; top: 55px; width: 100%; display: flex; justify-content: space-around; font-size: 7px; font-weight: 900; z-index: 90; }
        .hp-cont { width: 50px; height: 5px; border: 1px solid #000; background: #FFF; }
        .hp-fill { height: 100%; background: #000; width: 100%; }

        /* WORLD */
        .plat { position: absolute; background: #000; height: 8px; border-top: 2px solid var(--yellow); }
        .item { position: absolute; width: 12px; height: 12px; background: var(--safety); border: 1px solid #000; font-size: 6px; display: flex; justify-content: center; align-items: center; color: #FFF; }

        /* BUTTONS */
        .dpad { display: grid; grid-template-columns: repeat(3, 35px); grid-template-rows: repeat(3, 35px); }
        .btn { background: #1A1A1A; border-radius: 4px; border: 1px solid #444; display: flex; justify-content: center; align-items: center; color: #666; cursor: pointer; }
        .btn:active { background: #333; }
        .action { width: 45px; height: 45px; border-radius: 50%; background: #333; color: #FFF; display: flex; justify-content: center; align-items: center; font-weight: 900; box-shadow: 0 4px 0 #000; cursor: pointer; margin: 5px; }
        .start-select { width: 30px; height: 8px; background: #444; border-radius: 10px; cursor: pointer; margin-top: 20px; font-size: 5px; color: #FFF; display: flex; justify-content: center; align-items: center; }

        .hit { animation: shake 0.1s infinite; filter: invert(1); }
        @keyframes shake { 0% { left: 2px; } 100% { left: -2px; } }
    </style>
</head>
<body>

<div id="console">
    <div style="display:flex; flex-direction:column; align-items:center;">
        <div class="dpad">
            <div></div><div class="btn" id="up">▲</div><div></div>
            <div class="btn" id="left">◀</div><div></div><div class="btn" id="right">▶</div>
        </div>
    </div>

    <div id="screen">
        <div id="viewport">
            <div id="dock">
                <div class="dock-item" onclick="mod('ears')">"EARS"</div>
                <div class="dock-item" onclick="mod('teeth')">"TEETH"</div>
                <div class="dock-item" onclick="mod('fit', 'wide')">"S_BODY"</div>
                <div class="dock-item" onclick="mod('fit', 'taper')">"F_BODY"</div>
                <div class="dock-item" onclick="mod('color', '#000')">"BLK"</div>
                <div class="dock-item" onclick="mod('color', '#FF4500')">"ORG"</div>
                <div class="dock-item" onclick="mod('color', '#FF69B4')">"PNK"</div>
                <div class="dock-item" onclick="mod('color', '#00FFFF')">"CYN"</div>
                <div class="dock-item" onclick="mod('color', '#FFD700')">"YLW"</div>
                <div class="dock-item" onclick="mod('color', '#FFFFFF')">"WHT"</div>
                <div class="dock-item" onclick="mod('color', '#8A2BE2')">"VIO"</div>
            </div>

            <div id="hud">
                <div>P1 <div class="hp-cont"><div id="hp1" class="hp-fill"></div></div></div>
                <div>CPU1 <div class="hp-cont"><div id="hp2" class="hp-fill"></div></div></div>
                <div>CPU2 <div class="hp-cont"><div id="hp3" class="hp-fill"></div></div></div>
            </div>

            <div id="stage"></div>

            <div id="p1" class="player">
                <div class="head" id="h1"><div class="ears"><div class="ear"></div><div class="ear"></div></div><div class="teeth"></div></div>
                <div class="torso" id="t1">"ITEM"</div>
            </div>
            <div id="p2" class="player"><div class="head" style="background:var(--yellow)"><div class="teeth" style="display:block"></div></div><div class="torso" style="background:var(--yellow); color:#000">"CPU1"</div></div>
            <div id="p3" class="player"><div class="head" style="background:var(--safety)"><div class="teeth" style="display:block"></div></div><div class="torso" style="background:var(--safety)">"CPU2"</div></div>
        </div>
    </div>

    <div style="display:flex; flex-direction:column; align-items:center;">
        <div style="display:flex; transform:rotate(-15deg);">
            <div class="action" id="btnB" style="background:#444;">B</div>
            <div class="action" id="btnA" style="background:var(--safety);">A</div>
        </div>
        <div class="start-select" id="start-btn">START</div>
    </div>
</div>

<script>
    const inputs = { left: false, right: false, up: false, a: false, b: false };
    const config = { ears: false, teeth: false, color: '#000', fit: '' };
    let paused = true;

    const players = [
        { id: 'p1', x: 40, y: 150, vy: 0, hp: 100, jump: false, atk: false, dir: 1, type: 'user' },
        { id: 'p2', x: 140, y: 100, vy: 0, hp: 100, jump: false, atk: false, dir: -1, type: 'cpu' },
        { id: 'p3', x: 220, y: 150, vy: 0, hp: 100, jump: false, atk: false, dir: -1, type: 'cpu' }
    ];

    const plats = [
        { x: 0, y: 0, w: 400 }, { x: 30, y: 50, w: 80 }, { x: 150, y: 70, w: 80 }, { x: 80, y: 110, w: 100 }
    ];

    function initStage() {
        const s = document.getElementById('stage');
        plats.forEach(p => {
            const d = document.createElement('div');
            d.className = 'plat'; d.style.left = p.x + 'px'; d.style.bottom = p.y + 'px'; d.style.width = p.w + 'px';
            s.appendChild(d);
        });
    }

    function mod(type, val) {
        if(type === 'color') config.color = val;
        else if(type === 'fit') config.fit = val;
        else config[type] = !config[type];

        const h = document.getElementById('h1');
        const t = document.getElementById('t1');
        h.style.background = config.color;
        t.style.background = config.color;
        t.className = 'torso ' + config.fit;
        h.querySelector('.ears').style.display = config.ears ? 'flex' : 'none';
        h.querySelector('.teeth').style.display = config.teeth ? 'block' : 'none';
        t.style.color = (config.color === '#FFFFFF' || config.color === '#00FFFF') ? '#000' : '#FFF';
    }

    const bind = (id, k) => {
        const el = document.getElementById(id);
        el.onmousedown = el.ontouchstart = (e) => { e.preventDefault(); inputs[k] = true; };
        el.onmouseup = el.ontouchend = () => inputs[k] = false;
    };
    bind('left', 'left'); bind('right', 'right'); bind('up', 'up'); bind('btnA', 'a'); bind('btnB', 'b');
    document.getElementById('start-btn').onclick = () => { paused = !paused; document.getElementById('start-btn').innerText = paused ? "RESUME" : "PAUSE"; };

    function combat(atk) {
        if (atk.atk) return;
        atk.atk = true;
        const el = document.getElementById(atk.id);
        el.style.filter = "drop-shadow(0 0 5px var(--safety))";

        players.forEach(vic => {
            if (atk === vic || vic.hp <= 0) return;
            const dist = Math.abs(atk.x - vic.x);
            const height = Math.abs(atk.y - vic.y);
            if (dist < 40 && height < 30) {
                vic.hp -= inputs.a ? 10 : 4;
                vic.vy = -4; 
                document.getElementById(vic.id).classList.add('hit');
                setTimeout(() => document.getElementById(vic.id).classList.remove('hit'), 100);
            }
        });
        setTimeout(() => { atk.atk = false; el.style.filter = "none"; }, 300);
    }

    function loop() {
        if (!paused) {
            players.forEach((p, idx) => {
                if (p.hp <= 0) return;

                if (p.type === 'user') {
                    if (inputs.left) { p.x -= 2.5; p.dir = -1; }
                    if (inputs.right) { p.x += 2.5; p.dir = 1; }
                    if (inputs.up && !p.jump) { p.vy = -11; p.jump = true; }
                    if (inputs.a || inputs.b) combat(p);
                } else {
                    const target = players[0];
                    if (target.x < p.x - 30) { p.x -= 1.2; p.dir = -1; }
                    else if (target.x > p.x + 30) { p.x += 1.2; p.dir = 1; }
                    if (Math.random() > 0.985) combat(p);
                }

                p.y -= p.vy; p.vy += 0.6;
                p.jump = true;

                plats.forEach(plat => {
                    if (p.vy > 0 && p.y <= plat.y && p.y >= plat.y - 10 && p.x + 25 >= plat.x && p.x <= plat.x + plat.w) {
                        p.y = plat.y; p.vy = 0; p.jump = false;
                    }
                });

                p.x = Math.max(0, Math.min(260, p.x));
                const div = document.getElementById(p.id);
                div.style.transform = `translate(${p.x}px, ${-p.y}px) scaleX(${p.dir})`;
                document.getElementById(`hp${idx+1}`).style.width = p.hp + '%';
            });
        }
        requestAnimationFrame(loop);
    }

    initStage();
    loop();
</script>
</body>
</html>
